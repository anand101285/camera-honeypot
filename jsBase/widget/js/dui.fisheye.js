var g_componentPath="/jsBase/widget/js/";!function(a,b){var c=[],d=[],e=["CeilMode","WallMode","FloorMode"],f=2;that=null,a.widget("dui.fisheye",{version:"1.0.1",widgetName:"fisheye",widgetEventPrefix:"fisheye",options:{iid:"fisheye",ocxObject:a("#ocx"),chArry:[],datafor:[],oStrTmpl:{showVRMode:!1}},_create:function(){this.$container=this.element,this.iid=this.options.iid,this.ocxObject=this.options.ocxObject,this.chArry=this.options.chArry,this.datafor=this.options.datafor,this.curCh=0;for(var a=0;a<this.chArry.length;a++)c[this.chArry[a]]=1,d[this.chArry[a]]=0;this.init()},init:function(){that=this;var d;window.g_tmplStrFishEye?(d=new a.Deferred,d.resolve(g_tmplStrFishEye)):d=a.get(g_componentPath+"FishEye.tmpl"),d.done(function(d){d!=b&&(g_tmplStrFishEye=d),null!=that.$container&&(that.options.oStrTmpl.iid=that.options.iid,that.$container.html(a.template(d,that.options.oStrTmpl)),that._showPlayModeByFitMode(e[c[that.curCh]-1]),that._addEvent())})},_addEvent:function(){a("#"+that.iid+"_fisheyeOCX_fitMode").on("click",that._onFitModeChange),a("#"+that.iid+"_fisheyeOCX_playMode").delegate("li","click",that._onPlayModeChange),a(".vr").delegate("li","click",that._onPlayModeChange)},onVideoFishEyeClick:function(g,h,i){g.fisheyeinfo&&g.fisheyeinfo.Enable&&(i&&(that.datafor=i),that.curCh=g.channel,g.fisheyeinfo.InstallMode!=b&&(c[that.curCh]=g.fisheyeinfo.InstallMode,f=g.fisheyeinfo.VisualRangeMode),g.fisheyeinfo.ShowMode!=b&&(d[that.curCh]=g.fisheyeinfo.ShowMode),1==f?(a("#"+that.iid+"_fisheyeOCX_fitMode li").eq(0).prop("disabled",!0).addClass("fitMode_ceil_disabled"),a("#"+that.iid+"_fisheyeOCX_fitMode li").eq(2).prop("disabled",!0).addClass("fitMode_floor_disabled")):(a("#"+that.iid+"_fisheyeOCX_fitMode li").eq(0).prop("disabled",!1).removeClass("fitMode_ceil_disabled"),a("#"+that.iid+"_fisheyeOCX_fitMode li").eq(2).prop("disabled",!1).removeClass("fitMode_floor_disabled")),that._showPlayModeByFitMode(e[c[that.curCh]-1]),that._showCurrMode(),h===b&&(h=!0),h&&that._controlFe())},_showCurrMode:function(){var b=a("#"+that.iid+"_fisheyeOCX_fitMode");b.find("li").removeClass("current").filter("[data-for="+c[that.curCh]+"]").addClass("current"),a("#"+that.iid+"_fisheyeOCX_playMode li,.vr li").removeClass("current").filter("[data-for="+d[that.curCh]+"]").addClass("current")},_controlFe:function(){that.ocxObject.SetFeInstallMode(c[that.curCh]),that.ocxObject.SetFeShowMode(d[that.curCh])},show:function(){a("#"+this.iid+"_fisheyeOCX").css("display","block")},hide:function(){a("#"+this.iid+"_fisheyeOCX").css("display","none")},_onFitModeChange:function(b){var d=b||window.event,f=d.target||d.srcElement,g=a(f).attr("data-for");"LI"!=f.tagName||a(f).prop("disabled")||(a(this).children("li").removeClass("current"),a(f).addClass("current"),that._showPlayModeByFitMode(e[g-1]),c[that.curCh]=g-0,that.ocxObject&&that.ocxObject.SetFeInstallMode(c[that.curCh]),a("#"+that.iid+"_fisheyeOCX_playMode").children("li").removeClass("current"),a("#"+that.iid+"_fisheyeOCX_playMode li:visible:first").addClass("current").trigger("click"))},_onPlayModeChange:function(b){var c=b||window.event,e=c.target||c.srcElement,f=a(this);a("#"+that.iid+"_fisheyeOCX_playMode li,.vr li").filter("[data-for="+d[that.curCh]+"]").removeClass("current"),f.siblings("li").removeClass("current"),f.addClass("current"),d[that.curCh]=a(e).attr("data-for")-0,that.ocxObject&&that.ocxObject.SetFeShowMode(d[that.curCh])},_showPlayModeByFitMode:function(b){a("#"+this.iid+"_fisheyeOCX_playMode").children("li").each(function(){var c=a(this).attr("data-for");that.datafor.contains(c)&&a(this).attr("support-for").indexOf(b)>-1?a(this).css("display","block"):a(this).css("display","none")})}})}(jQuery);