function getNewVersion(){var a=new CloudUpgrader,b={way:2};a.getAutoCheck(function(c,d){if(d.result){var e=d.params.flag;e?a.check(b,function(a,b){if(b.result){var c=b.params.info;c&&"None"!==c.State?(g_hasNewVersion=!0,showRedTip(!0)):(g_hasNewVersion=!1,showRedTip(!1))}else g_hasNewVersion=!1,showRedTip(!1)}):(g_hasNewVersion=!1,showRedTip(!1))}else g_hasNewVersion=!1,showRedTip(!1)})}function showRedTip(a){if(0!==$$("#xxtpz span").length&&$$("#xxtpz span").destroy(),0!==$$("#setup li[category=sysmng] span b").length&&$$("#setup li[category=sysmng] span b").destroy(),0!==$$("#setup li[filename=update] span b").length&&$$("#setup li[filename=update] span b").destroy(),a){var b=new Element("span",{"class":"tip-circle-text",html:1}),c=new Element("b",{"class":"tip-circle-text",html:1}),d=new Element("b",{"class":"tip-circle-text",html:1});$$("#xxtpz")[0]&&$$("#xxtpz")[0].appendChild(b),setTimeout(function(){$$("#setup li[category=sysmng] span")[0]&&0==$$("#setup li[category=sysmng] span b").length&&$$("#setup li[category=sysmng] span")[0].appendChild(c),$$("#setup li[filename=update] span")[0]&&0==$$("#setup li[filename=update] span b").length&&$$("#setup li[filename=update] span")[0].appendChild(d)},500)}}function checkMimeType(a){for(var b=navigator.mimeTypes,c=[],d=0;d<b.length;d++)if(c.push(b[d].type),a.contains(b[d].type))return!0;return!1}function getRemoteParams(){var a=window.location.href,b=a.split(/[?]/);if(b.length>=2){remoteParams.ALL=b[1];var c=b[1].split("&"),d=[];c.each(function(a){d.extend(a.split("="))});for(var e=0;e<d.length;e++)switch(d[e]){case"username":remoteParams.uName=d[++e];break;case"password":remoteParams.pwd=d[++e];break;case"ccid":remoteParams.ccid=d[++e];break;case"t2uip":remoteParams.t2uip=d[++e];break;case"t2uport":remoteParams.t2uport=d[++e];break;case"p2pport":remoteParams.t2utcpport=d[++e];break;case"ddnshost":remoteParams.ddnshost=d[++e];break;case"devwebport":remoteParams.devwebPort=d[++e];break;case"from":remoteParams.from=d[++e]}("remote"==remoteParams.from||void 0!=remoteParams.uName&&void 0!=remoteParams.pwd)&&(g_isRemoteLogin=!0)}}function getDeviceType(a){return jQuery.when(webApp.ability.get("DeviceType"),webApp.ability.get("DeviceClass")).then(function(b,c){g_deviceSubType=b,g_deviceType=c,g_deviceSubType.contains("EVS")&&g_deviceType.contains("EVS")&&(g_deviceType="NVR"),g_deviceSubType.contains("ARC")&&(g_deviceType="DVR"),a&&a()})}function initFrames(){g_frames.preview=window.frame_preview,g_frames.alarm=window.frame_alarm,g_frames.setup=window.frame_set}function showLogin(){$("l").style.display="",$("m").style.top="-10000px",hasPlugin&&g_isDeviceInited&&(""!=$("username").value?g_isRemoteLogin||$("password").focus():g_isRemoteLogin||$("username").focus())}function refreshSessionID(){rpcCore.sessionID=RPC.getSession(),g_frames.preview&&(g_frames.preview.rpcCore=rpcCore),g_frames.playback&&(g_frames.playback.rpcCore=rpcCore),g_frames.alarm&&(g_frames.alarm.rpcCore=rpcCore),g_frames.setup&&(g_frames.setup.rpcCore=rpcCore)}function cancelWeakPasswordTip(){var a={Enable:!1},b=ConfigManager.instance();b.setConfig(["SecurityWarn"],[a])}function showSecurityTips(){if((new MagicBox).getProductDef(["UserNameLimit","PassWordLimit","GroupNameLimit","AbroadInfo"],function(a,b){if(b.result&&"array"===$type(b.params)){var c=b.params;c[0].result&&c[0].params&&(g_userNameLimit=c[0].params.definition),c[1].result&&c[1].params&&(g_passWordLimit=c[1].params.definition),c[2].result&&c[2].params&&(g_groupNameLimit=c[2].params.definition),c[3].result&&c[3].params&&(g_abroadInfo=c[3].params.definition)}},!1),g_wifiDevice=!!webApp.webCap.b_supportWifiFunc,"admin"!=$("username").value||g_isRemoteLogin)return void loginFinish();var a=!1,b=function(b,c){var d=c.params;d&&d[0].result&&(a=d[0].params.table.Enable||!1),"Digimerge"==webApp.webCap.vendor&&(a="000000"==$("password").value)};if(!webApp.webCap.b_SupportDeviceInit){var c=ConfigManager.instance();c.getConfig(["SecurityWarn"],b,!1)}var d=!0;webApp.webCap.IsIndiaProgram&&a&&(d=getUserPassModTime($("username").value));loginFinish()}function getUserPassModTime(a){var b=!0,c=function(a){if(JSON.decode(a).result){var c=JSON.decode(a).params.user.PasswordModifiedTime;b="2000:00:00-00:00:00"==c?!0:!1}},d=new UserManager;return d.getUserInfo(a,c,!1),b}function change_admin_password(){var a=$("modadmin_newPassword").value,b=$("password").value;RPC.UserManager.modifyPassword("admin",a,b,3).done(function(){webApp.webCap.IsIndiaProgram||cancelWeakPasswordTip(),dlgModAdminPassword.hide(),loginFinish()}).fail(function(){alert(tl("com_msg.Operateingfailure")),dlgModAdminPassword.hide()})}function admin_change(){var a=$("modadmin_newPassword").value,b=tl("com_msg.AdminPwdNotDefault").replace(/%s/g,"admin");a!=$("modadmin_confirmPassword").value?remarkDisplay("modadmin_remark",tl("opr_ugm.passwdnotmatch"),3e3,1):"admin"==a?remarkDisplay("modadmin_remark",b,3e3,1):a==$("password").value?remarkDisplay("modadmin_remark",tl("com_msg.ugm.pwdsame"),3e3,1):a.length<g_passWordLimit[0]?"Digimerge"==webApp.webCap.vendor?remarkDisplay("modadmin_remark",tl("ugm_msg.passwd_pattern_wrong"),3e3,1):remarkDisplay("modadmin_remark",tl("com_msg.PasswdLenNotValid")+" "+g_passWordLimit[0]+"-"+g_passWordLimit[1],3e3,1):""==a?remarkDisplay("modadmin_remark",tl("com_msg.PwdNotNull"),3e3,1):"Digimerge"==webApp.webCap.vendor&&"000000"===a?remarkDisplay("modadmin_remark",tl("ugm_msg.passwd_pattern_wrong"),3e3,1):"HoneyWell"!=webApp.webCap.vendor||isStrongPassword(a)?change_admin_password():remarkDisplay("modadmin_remark",tl("ugm_msg.user_password_to_simple"),3e3,1)}function admin_skip(){return"Digimerge"==webApp.webCap.vendor?(doWithLoginFailure(),void webLogout()):($("weakPassword_enable").checked=!1,void dlgNerverShowModAdminPassword.show())}function nerver_show_yes(){$("weakPassword_enable").checked&&cancelWeakPasswordTip(),dlgNerverShowModAdminPassword.hide(),loginFinish()}function nerver_show_cancel(){$("modadmin_newPassword").value="",$("modadmin_confirmPassword").value="",g_weakPasswordTip&&g_modadminpwdLevel.defaultState(),dlgModAdminPassword.show()}function emptyPassword_yes(){dlgEmptyPasswordWarn.close(),change_admin_password()}function showpassword(){var a=$("password").value;$("passwordInput").innerHTML=$("login_showpwd").checked?' <input id="password" type="text" class="ui-input fn-width163 oem_pass" onKeyDown="javascript:if (event.keyCode==13) login();"maxlength="32"/>':' <input id="password" type="password" class="ui-input fn-width163 oem_pass" onKeyDown="javascript:if (event.keyCode==13) login();"maxlength="32"/>',$("password").value=a}function login(){if(!g_previewLoaded)return void login.delay(100);var a=$("username").value,b=$("password").value,c=!1,d=0;if(!$("net_wan").checked&&!$("net_lan").checked&&!g_isRemoteLogin)return void alert(tl("Please choose the type!"));$("net_wan").checked&&(d=1),g_netType=d;var e=$("s_lgType").value-0;g_ocx.SetOEM(g_vendor),g_busernameEncrypt&&g_ocx.SetOEM("usernameEncrypt"),c=null,c=g_isRemoteLogin?g_frames.preview.loginOCX(a,b,d,e,remoteParams.ccid,remoteParams.t2uip,remoteParams.t2uport,remoteParams.t2utcpport):g_frames.preview.loginOCX(a,b,d,e),c.done(function(c){c?(g_autoPassword=b,RPC.login(a,b,g_useApp||!$("ocx")).done(function(){var a=RPC.getSession();rpcCore.sessionID=a,("WatchNet"==g_vendor||g_busernameEncrypt)&&Cookie.write("username",$("username").value,{path:"/"}),webApp.getGlobalConfigs(),showSecurityTips(),beginKeepAlive(),jQuery.subscribe("SessionInvalid",function(b,c){c==a&&(jQuery("body").off("click"),jQuery("body").one("click",function(){alert(tl("com_msg.ConnectionOvertime")),location.replace("/")}))})}).fail(function(a){switch(a&&a.error&&a.error.code){case 268632070:alert(tl("com_fail.LoginErrorNo-17"));break;case 268632071:alert(a.params&&void 0!==a.params.remainLoginTimes&&0!==a.params.remainLoginTimes?tl("com_msg.ugm.userpwdfailed").replace("%d",a.params.remainLoginTimes):tl("com_fail.LoginErrorNo-17"));break;case 268632072:alert(tl("com_fail.LoginErrorNo-6"));break;case 268632073:alert(tl("opr_ocx.The user is invalid."));break;case 268632074:alert(tl("com_fail.LoginErrorNo-4"));break;case 268632075:alert(tl("opr_ocx.the number of connection is maximal.request is refused!"));break;case 268632081:alert(a.params&&void 0!==a.params.remainLockSecond&&0!==a.params.remainLockSecond?tl("com_msg.ugm.accountlocked").replace("%d",Math.ceil(a.params.remainLockSecond/60)):tl("com_fail.LoginErrorNo-5"));break;case 268632085:alert(a.params&&void 0!==a.params.remainLoginTimes&&0!==a.params.remainLoginTimes?tl("com_msg.ugm.userpwdfailed").replace("%d",a.params.remainLoginTimes):tl("com_fail.LoginErrorNo-17"));break;default:alert(tl("com_msg.Login failure!"))}doWithLoginFailure()})):doWithLoginFailure()})}function loginFinish(){var a=$("username").value,b=$("password").value;getDeviceType(function(){webApp.webCap.b_supportCloudUpdate&&getNewVersion(),Ability.initial(),g_basePassword=Base64.encode(a+":"+b),g_loginInfo.username=a,g_loginInfo.password=b,g_loginInfo.loginType=$("s_lgType").value-0,g_loginInfo.hasLogin=!0,refreshSessionID(),getCurAuthorityList(),g_frames.preview.pageInit(),getDiskPnts(),hasPlugin&&g_ocx.GetLoginID().done(function(a){settings.loginid=a}),settings.pswd="",g_ocx&&g_ocx.SetModuleMode(0==g_netType?1:10),webApp.ability.is("supportPos").done(function(a){a&&(g_bSupportPos=!0)}).always(function(){enableIvs()}),checkAuthority("AuthSysInfo")?($("b_d").style.display="",$("b_x").style.display=""):($("b_d").style.display="none",$("b_x").style.display="none");var c={Protocol:"AuthManuCtr",Params:{Enable:checkAuthority("AuthManuCtr")}};g_ocx&&g_ocx.ProtocolPluginWithWebCall(JSON.encode(c));var d="f_preview";if(g_deviceSubType.contains("ARC")){d="f_alarm";var e=$("nav"),f=$("b_d"),g=$("b_a");e.removeChild(f),e.insertBefore(f,g)}else setTimeout(function(){changeOcxMode("Preview"),changeNavStyle($("xyl"))},0);if(document.title=tl("com_menu.PREVIEW_TITLE"),$("l").style.display="none",$("m").style.top="0px",showIframe(d),resize(),g_frames.preview.multiPreview.setMultiPreviewVideoOut(),settings.username=a,savesetting(),checkIsSDIDev(),"HoneyWell"===webApp.webCap.vendor&&($("username").value=""),$("password").value="",checkReplayAuth(),checkIntelplayAuth(),g_isRemoteLogin&&loadPlayAndAlarmPage.delay(0),g_deviceSubType.contains("ARC")&&showAlarmVisonPage(),!g_bSupportFisheye){var h={Protocol:"VideoFuncProtocol",Params:{Fisheye:!1}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(h))}if(webApp.ability.get("4kMutiDisplay").done(function(a){if(a){var b={Protocol:"VideoFuncProtocol",Params:{MultiScreen:!0}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(b))}}),parent.webApp.webCap.b_MultiPlayRightCheck){var h={Protocol:"EnableMultiPlayRightCheck",Params:{Enable:!1}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(h))}webApp.preloadModule()});var c=g_frames.alarm.comet;g_frames.alarm.rpcCore=rpcCore,jQuery.getJSON("/RPC2_Notify_Method").done(function(a){if(a.NotifyMethod)webApp.Common.devNotify.subscribe("client.notifyEventStream",g_frames.alarm.receiveMessage);else{var b="/cgi-bin/eventManager.cgi?action=notifyEventStream&sessionId="+rpcCore.sessionID;c.setSrc(b)}(new EventManager).attachEvent(["KickOut"])}),!isMac||webApp.webCap.b_supportDownMac||hasPlugin||$("pluginsetup").setProperty("href","javascript:;"),g_forNacl&&!g_fromChromeApp&&($("pluginsetup").href="https://chrome.google.com/webstore/detail/easy-viewer/anjoggeimnldigfcihcggejncophmhjc",$("pluginsetup").setProperty("text",tl("com_msg.needChromeApp")))}function setIvsTypeOCXEnable(a,b){var c={Protocol:"SetIVSEnable",Params:{Enable:b,IVSType:a}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(c))}function enableIvs(){Ability.ivsCaps.support&&RPC.ConfigManager.getConfig("GUISet").done(function(a){g_isShowIVS=a[0].IntelliRuleShowEnable,setIvsTypeOCXEnable(7,a[0].IntelliRuleShowEnable),parent.webApp.webCap.b_supportThermography&&g_frames.preview.PointTemper.setShowEnable(a[0].RandomPointTemperEnable)}),g_bSupportPos&&webApp.ability.is("supportPos").then(function(a){2==a?RPC.POS.getPosAll().done(function(a){var b=a.params.pos||[],c=[];c=jQuery.grep(b,function(a){return a.Enable&&a.OverlayEnable}),setIvsTypeOCXEnable(8,c.length>0)}):RPC.ConfigManager.getConfig("PosGlobal").done(function(a){setIvsTypeOCXEnable(8,-2!==a.PreviewBlend[0])})})}function doWithLoginFailure(){g_isRemoteLogin&&showLogin(),$("password").value="",$("password").focus()}function initLangSelect(){var a=new MagicBox,b=function(a){for(var b=JSON.decode(a).params.definition,c="",d=0;d<b.length;d++)c+=b[d]==curLang?'<a href="javascript:;" class="J_current" data-lang="'+b[d]+'">'+tl(b[d])+"</a>":'<a href="javascript:;" data-lang="'+b[d]+'">'+tl(b[d])+"</a>";$("language_list").innerHTML=c,$$("#select_language .J_select_center").set("text",tl(curLang)),$$("#language_list a").addEvent("click",function(){$$("#language_list a").removeClass("J_current"),this.addClass("J_current"),$("language_list").style.display="none",reTranslate(this.getProperty("data-lang"))})};a.getProductDef("Languages",b)}function reTranslate(a){if(curLang!=a){curLang=a;var b="/custom_lang/"+a+".txt",c="/web_lang/"+a+".txt";switch(getLangFile(b,c),$$("#select_language .J_select_center").set("text",tl(curLang)),g_pageID){case 0:document.title=tl("com_menu.PREVIEW_TITLE");break;case 1:document.title=tl("com_menu.PLAYBACK_TITLE");break;case 2:document.title=tl("com_menu.CONFIG_TITLE");break;case 3:document.title=tl("com_menu.ALARM_TITLE");break;case 4:document.title=tl("com_str.info");break;default:document.title=tl("WEB SERVICE")}g_frames.preview.inilanguage(),g_frames.alarm.getlang(),g_frames.alarm.initlanguage(),$("frame_set").src.contains("setindex.htm")&&(g_frames.setup.getlang(),g_frames.setup.inilanguage(),g_frames.setup.initLang())}}function chk10(a){var b=a-0;return 10>a-0?"0"+(b-0):b}function checkIsSDIDev(){var a=function(a,b){var c=b.result;if(c){var d=b.params.caps.SetColor;g_isSDIDev=d?0:1,Ability.dynamicResolution=b.params.caps.DynamicResolution||!1}},b=new DevVideoOut;b.instance(0,function(c,d){var e=1;d.result&&(e=d.result),b.getCaps(e,a)})}function checkReplayAuth(){$("b_ab").style.display="none";for(var a=0;a<g_frames.preview.CHANNEL_NUMBER;a++)if(checkAuthority("Replay_"+chk10(a+1))||checkAuthority("Replay")&&g_deviceSubType.contains("EVS")){$("b_ab").style.display="";break}}function checkIntelplayAuth(){$("b_ac").style.display="none",RPC.RecordAnalyse.getUsage().done(function(a){if(a&&$("b_ac"))for(var b=0;b<g_frames.preview.CHANNEL_NUMBER;b++)if(checkAuthority("Replay_"+chk10(b+1))){$("b_ac").style.display="";break}})}function changeNavStyle(a){$("nav").getElements("a").each(function(a){a.removeClass("main-nav-item-current")}),a.addClass("main-nav-item-current")}function showPreviewPage(){g_timerdcs=$clear(g_timerdcs),g_deviceSubType.contains("ARC")&&g_frames.alarm.g_TimeOut&&g_frames.alarm.stopGetAlarmState(),0!=g_pageID&&(1==g_pageID&&hasPlugin&&stopPlayBack(),g_frames.preview.multiPreview.showAndGetMultiPreview(),document.title=tl("com_menu.PREVIEW_TITLE"),g_ocx&&g_ocx.SetModuleMode(0==g_netType?1:10),enableIvs(),g_ocx&&g_ocx.PlayStopSound(),showIframe("f_preview"),changeOcxMode("Preview"),changeNavStyle($("xyl")),2==g_pageID||1==g_pageID||3==g_pageID||4==g_pageID||5==g_pageID?(g_pageID=0,stopSetVideo(),g_frames.preview.g_closeAll?g_frames.preview.refreshChNameList().done(function(){var a=!1;webApp.webCap.b_supportWatchMan&&(a=g_frames.preview.WatchMan.reStartWatch()),a||g_frames.preview.resumePlay()}):g_frames.preview.refreshChNameList()):g_frames.preview.refreshChNameList(),g_pageID=0,resize(),g_frames.preview.closeIconMenus(),g_frames.preview.refreshAlarmChn(),g_frames.preview.getRecordState(),g_frames.preview.typeDisplay(!1),g_frames.preview.getLayoutNameCfg(),""!=g_VideoSecurity&&(g_frames.preview.$securityIpt.value=g_VideoSecurity,setVideoSecurityKey(g_VideoSecurity)));var a=webApp.webCap.b_hideCapturePic?!1:!0,b={Protocol:"VideoFuncProtocol",Params:{Snapshot:a}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(b));var c={Protocol:"VideoFuncProtocol",Params:{MultiScreen:!0}};if(parent.g_ocx.ProtocolPluginWithWebCall(JSON.encode(c)),g_bSupportFisheye){var d={Protocol:"VideoFuncProtocol",Params:{Fisheye:!0}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(d))}}function showPlaybackPage(){if(g_timerdcs=$clear(g_timerdcs),g_deviceSubType.contains("ARC")&&g_frames.alarm.g_TimeOut&&g_frames.alarm.stopGetAlarmState(),!hasPlugin)return void showPluginSetup();if(1!=g_pageID){if(!g_playAndAlarmLoad)return;if(0==g_playLoadState)return void loadPlaybackHtml();if(g_frames.preview.closeAllVideos(),document.title=tl("com_menu.PLAYBACK_TITLE"),g_pageID=1,showIframe("f_playback"),$("play_page_playback").style.top="0px",$("play_page_downmore").style.display="none",$("playback_lockSearch_div").setStyle("display","none"),$("play_page_tagmanager").setStyle("display","none"),changeNavStyle($("xlxcx")),g_ocx&&g_ocx.SetModuleMode(4),stopPlayBack(),1==g_playLoadState?(PlayBack.showCalendarToday(),changeOcxMode("Hidden"),changeOcxMode("Playback"),resize(),setTimeout(function(){1==g_pageID&&(PlayBack.init(),resize(),g_playLoadState=2)},0)):2==g_playLoadState?(changeOcxMode("Playback"),PlayBack.render(),resize(),PlayBack.resumeWindBinded(),webApp.webCap.b_showNewPlay||PlayBack.AddRecordInfoByChannel()):(changeOcxMode("Playback"),PlayBack.init(),resize(),g_playLoadState=2),PlayBack.play2Show(),PlayBack.IsNeedShowSyncPlay(),g_deviceSubType.contains("EVS")&&PlayBack.initChnlNameSelect(),""!=g_VideoSecurity&&($("plb_SecurityKey_ipt").value=g_VideoSecurity,setVideoSecurityKey(g_VideoSecurity)),g_bSupportFisheye){var a={Protocol:"VideoFuncProtocol",Params:{Fisheye:!0}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(a))}}}function showAlarmPage(){if(g_timerdcs=$clear(g_timerdcs),3!=g_pageID){if(!g_playAndAlarmLoad)return;1==g_pageID&&hasPlugin&&stopPlayBack(),g_frames.preview.closeAllVideos(),document.title=tl("com_menu.ALARM_TITLE"),g_pageID=3,changeOcxMode("Hidden"),showIframe("f_alarm"),hiddenTip(),changeNavStyle($("xbjsz")),stopSetVideo();{g_frames.alarm.comet}if(0==g_alarmed){var a,b,c=ChannelNumInfo.instance();if(a=c.getAlarmIN(),b=c.getAlarmOUT(),0==a&&0==b&&(g_frames.alarm.$("showAlarmType_5").style.display="none"),g_deviceSubType.contains("EVS")?(g_deviceSubType.contains("EVS7")&&(g_frames.alarm.$("showAlarmType_8").setStyle("display","block"),g_frames.alarm.$("showAlarmType_13").setStyle("display","block")),g_frames.alarm.$("showAlarmType_6").style.display="",g_frames.alarm.$("showAlarmType_7").style.display="",g_frames.alarm.$("showAlarmType_9").setStyle("display","block")):g_deviceSubType.contains("NVR")?(g_frames.alarm.$("showAlarmType_6").style.display="",g_frames.alarm.$("showAlarmType_7").style.display=""):(g_frames.alarm.$("showAlarmType_6").style.display="none",g_frames.alarm.$("showAlarmType_7").style.display="none"),Ability.ivsCaps.support&&g_frames.alarm.$("showAlarmType_10").setStyle("display","block"),Ability.audioDetect.support&&g_frames.alarm.$("showAlarmType_11").setStyle("display","block"),webApp.webCap.b_hideIPCExtraAlarm&&(g_frames.alarm.$("showAlarmType_6").style.display="none"),webApp.webCap.b_hideIPCAbortAlarm&&(g_frames.alarm.$("showAlarmType_7").style.display="none"),Ability.b_supportDiskCheck&&(g_frames.alarm.$("showAlarmType_12").style.display=""),webApp.webCap.b_supportThermography)for(var d=14;19>=d;d++)g_frames.alarm.$("showAlarmType_"+d).style.display="";g_alarmed=1}}}function showAlarmVisonPage(){if(g_timerdcs=$clear(g_timerdcs),3!=g_pageID){if(!g_playAndAlarmLoad)return;1==g_pageID&&hasPlugin&&stopPlayBack(),g_frames.preview.closeAllVideos(),document.title=tl("com_menu.ALARM_TITLE"),g_pageID=3,changeOcxMode("Hidden"),showIframe("f_alarm"),hiddenTip(),changeNavStyle($("xbjsz")),stopSetVideo();var a=g_frames.alarm.if_alarm;if(0==g_alarmed){g_frames.alarm.rpcCore=rpcCore,a.src="/cgi-bin/eventManager.cgi?action=notifyEventStream&sessionId="+rpcCore.sessionID;var b,c,d=ChannelNumInfo.instance();b=d.getAlarmIN(),c=d.getAlarmOUT(),g_alarmed=1,g_frames.alarm.attachAll()}g_frames.preview.closeAllVideos(),g_frames.alarm.initAlarm(),g_frames.alarm.g_TimeOut||g_frames.alarm.startGetAlarmState()}}function showTip(){$("d_alarmtip").style.display=""}function hiddenTip(){$("d_alarmtip").style.display="none"}function showFaceSch(){g_deviceSubType.contains("ARC")&&g_frames.alarm.g_TimeOut&&g_frames.alarm.stopGetAlarmState(),6!=g_pageID&&(1==g_pageID&&stopPlayBack(),g_frames.preview.closeAllVideos(),document.title=tl("com_menu.CONFIG_TITLE"),g_pageID=6,changeOcxMode("Hidden"),showIframe("faceSch"),changeNavStyle($("b_face").getChildren("a")),seajs.use("/js/pageManage",function(a){Page.FaceSch?(Page.FaceSch.setCurFrame(Page.FaceSch),startSetVideo(),Page.FaceSch.curPage.render()):Page.FaceSch=new a("faceSch")}))}function showSetupPage(){g_deviceSubType.contains("ARC")&&g_frames.alarm.g_TimeOut&&g_frames.alarm.stopGetAlarmState(),2!=g_pageID&&(1==g_pageID&&stopPlayBack(),g_frames.preview.closeAllVideos(),document.title=tl("com_menu.CONFIG_TITLE"),g_pageID=2,changeOcxMode("Hidden"),showIframe("setup"),changeNavStyle($("xxtpz")),seajs.use("/js/pageManage",function(a){Page.Setup?(Page.Setup.setCurFrame(Page.Setup),startSetVideo(),Page.Setup.curPage&&Page.Setup.curPage.render()):Page.Setup=new a("setup"),webApp.webCap.b_supportCloudUpdate&&showRedTip(g_hasNewVersion)}))}function cancelUpgrade(){var a=RemoteUpgrader.instance();a.cancel(function(){})}function closeMasterSlave(){webApp.ability.get("MasterSlave").done(function(a){a&&0===g_pageID&&g_frames.preview.MasterSlave.showTracker({Enable:!1})})}function showPage(a){var b={0:"preview",1:"playback",2:"setup",3:"alarm",4:"sysinfo",5:"intelPlay",6:"faceSch"};keepAliveDef&&"pending"===keepAliveDef.state()||(keepAliveDef=RPC.Global.keepAlive().done(function(){switch($j.each(Page,function(c,d){b[g_pageID]!=a&&d.curPage&&d.curPage.leave()}),5===g_pageID&&Page.IntelPlay.leave(),closeMasterSlave(),a){case"preview":showPreviewPage();break;case"playback":showPlaybackPage();break;case"intelPlay":showIntelPlayPage();break;case"alarm":g_deviceSubType.contains("ARC")?showAlarmVisonPage():showAlarmPage();break;case"setup":showSetupPage();break;case"faceSch":showFaceSch();break;case"sysinfo":showInfoPage()}}).fail(function(){alert(tl("com_msg.ConnectionOvertime"))}))}function showInfoPage(){g_timerdcs=$clear(g_timerdcs),g_deviceSubType.contains("ARC")&&g_frames.alarm.g_TimeOut&&g_frames.alarm.stopGetAlarmState(),4!=g_pageID&&(1==g_pageID&&stopPlayBack(),g_frames.preview.closeAllVideos(),document.title=tl("com_str.info"),g_pageID=4,changeOcxMode("Hidden"),showIframe("info"),changeNavStyle($("xxinxi")),seajs.use("/js/pageManage",function(a){Page.Info?(Page.Info.setCurFrame(Page.Info),Page.Info.curPage&&Page.Info.curPage.render()):Page.Info=new a("info")}))}function showIntelPlayPage(){var a="";g_timerdcs=$clear(g_timerdcs),5!=g_pageID&&(1==g_pageID&&stopPlayBack(),g_frames.preview.closeAllVideos(),document.title=tl("opr_record.intellipiay"),g_pageID=5,changeNavStyle($("xznhf")),g_ocx&&g_ocx.SetModuleMode(4),a=webApp.webCap.b_supportNewIntelligence?"intelligentplaynew":"intelligentplay",seajs.use("/html/"+a+".htm",function(){}),seajs.use("/js/"+a+".js",function(a){changeOcxMode("Hidden"),showIframe("f_intelPlayback"),Page.IntelPlay?Page.IntelPlay.render():Page.IntelPlay=a()}))}function showIframe(a){$("f_preview").style.top="-10000px",$("f_playback").style.top="-10000px",$("faceSch").style.top="-10000px",$("f_alarm").style.top="-10000px",$("setup").style.top="-10000px",$("info").style.top="-10000px",$("f_intelPlayback")&&($("f_intelPlayback").style.top="-10000px"),$(a).style.top="NSS"===webApp.webCap.vendor?"90px":"69px",g_ocx.hideInvalidItems&&g_ocx.hideInvalidItems(a)}function webLogout(){return g_stateUpgrading?void alert(tl("com_msg.UpgradingForbidExitWeb")):(g_stateIPCUpdate&&(cancelUpgrade(),g_stateIPCUpdate=!1),webApp.webCap.b_supportWatchMan&&g_frames.preview.WatchMan.closeWatch(),g_firstIPCUpdate=!0,1==g_pageID&&stopPlayBack(),$.publish("logout"),document.title=tl("WEB SERVICE"),g_alarmed=0,void 0!=g_frames.preview.g_authorityListPtz&&(g_frames.preview.g_authorityListPtz=[]),hiddenTip(),g_deviceSubType.contains("ARC")||g_frames.alarm.nochkType(),showLogin(),g_frames.preview.closePreScrn(),Sys.ie?("Camera"==g_mode&&hasPlugin&&g_ocx.StopPreview(),PlayBack.goLogout(),g_frames.preview.goLogout(),hasPlugin&&g_ocx.PlayStopSound()):hasPlugin&&("Preview"==g_mode&&(g_ocx.PlayStopSound(),g_ocx.DisConnectAllChannel()),g_frames.preview.closeAudioTalk(),PlayBack.goLogout(),g_ocx.LogoutDevice()),doLogout(),g_frames.alarm.alarmLogout(),releasePage(),loadJavaScript("/js/playbackindex.js",function(){}),loadPlaybackHtml.delay(500),resetAllStatus(),changeOcxMode("Hidden"),g_loginInfo={username:"",password:"",loginType:0,hasLogin:!1},webApp.webCap.b_supportThermography&&g_frames.preview.PointTemper.clearCounter(),jQuery.unsubscribe("SessionInvalid"),void jQuery("body").off("click"))}function releasePage(){for(var a in Page)Page[a].destory&&(Page[a].destory(),delete Page[a])}function exit2LoginPage(){return g_isRemoteLogin?void webLogout():g_stateUpgrading?void alert(tl("com_msg.UpgradingForbidExitWeb")):(g_stateIPCUpdate&&(cancelUpgrade(),g_stateIPCUpdate=!1),g_firstIPCUpdate=!0,document.title=tl("WEB SERVICE"),$("m").style.top="-10000px",$("l").style.display="",g_alarmed=0,hiddenTip(),g_deviceSubType.contains("ARC")||g_frames.alarm.nochkType(),g_frames.preview.goLogout(),void resetAllStatus())}function resetAllStatus(){showIframe("f_preview"),null!=g_frames.preview.g_channel_in&&g_frames.preview.g_channel_in.setStyle("marginTop",0),changeNavStyle($("xyl")),g_pageID=0,g_playLoadState=3,$.publish("restart")}function startSetVideo(){var a=!!$$("#setup-content #CAMERA").length,b=!!$$("#setup-content #page_ipcIntellentNewConfig").length,c=!!$$("#setup-content #page_FaceNewConfig").length;a&&(g_ocx&&g_ocx.SetModuleMode(9),changeOcxMode("Camera"),Openrealstream()),b&&Page.ipcIntellentNewConfig._goThisPage(),c&&(Page.ipcFaceNewConfig.plugin.init(),Page.ipcFaceNewConfig.render())}function stopSetVideo(){hasPlugin&&g_ocx.StopPreview()}function stopPlayBack(){try{g_ocx.CloseAllNetPlayback()}catch(a){console.log(a)}}function showOcxPosInfo(a){var b={Protocol:"PosInfoDrawEnable",Params:{Enable:a}};g_ocx.ProtocolPluginWithWebCall(JSON.encode(b))}function savesetting(){HashCookie.extend(settings)}function getsetting(){settings.username=HashCookie.get("username")?HashCookie.get("username"):"",settings.pswd="",settings.talktype=HashCookie.get("talktype")?HashCookie.get("talktype"):"1",settings.logintype=HashCookie.get("logintype")?HashCookie.get("logintype"):"0",settings.openall=HashCookie.get("openall")?HashCookie.get("openall"):"1",webcapDefer.done(function(){"HoneyWell"===webApp.webCap.vendor?$("username").setProperty("value",""):$("username").setProperty("value",settings.username),webApp.webCap.b_SupportDeviceInit&&$("forgettPwd").setStyle("display","")}),$("password").setProperty("value",settings.pswd)}function resize(){resizeVideo(),resizeVideo()}function resizeVideo(){var a=caculateFrameWH();if(0!==a[2]){var b=a[0],c=a[1];if(parseInt($("f_preview").getStyle("height"))!=c+10||b-2!=parseInt($("f_preview").getStyle("width")))switch(Sys.ie?($("f_preview").setStyle("width",b-4),$("f_preview").setStyle("height",c+10),$("f_alarm").setStyle("width",b-2),$("f_alarm").setStyle("height",c),$("setup").setStyle("width",b-4),$("setup").setStyle("height",c),$("nav_head").setStyle("width",b-4),$("info").setStyle("width",b-4),$("info").setStyle("height",c),$("m").setStyle("height",c.toInt()>680?c+85:c)):($("f_preview").setStyle("width",b-6),$("f_preview").setStyle("height",c+10),$("f_alarm").setStyle("width",b-2),$("f_alarm").setStyle("height",c),$("setup").setStyle("width",b),$("setup").setStyle("height",c),$("nav_head").setStyle("width",b),$("info").setStyle("width",b-6),$("info").setStyle("height",c+10)),5==g_pageID&&Page.IntelPlay.resize(),g_mode){case"Preview":g_previewLoaded&&(g_frames.preview.adjustVideoSize(b-2,c),changeOcxStyle({width:b-317,height:c-36-49}));break;case"Playback":a=caculatePlayFrameWH(),b=a[0],c=a[1],adjustPlayback(b,c-3),changeOcxStyle({width:b-224,height:c-198-3})}}}function adjustPlayback(a,b){var c=a-220,d=b-208;if(null!=$("div_showPlayOcx")&&(d!=parseInt($("div_showPlayOcx").getStyle("height"))+1||c!=parseInt($("div_showPlayOcx").getStyle("width")))){$("J_pb_topleft").setStyle("height",d+40),$("J_pb_topleft").setStyle("width",c),$("play_page_playback").setStyle("width",a-5),$("div_showPlayOcx").setStyle("height",d+30),$("rogatoryFileListBox").setStyle("height",d-255);var e=0;webApp.webCap.b_showNewPlay&&(e=135);var f=Math.min(d-185-e,372);$("divListStart").setStyle("height",f),$("div_showPlayOcx").setStyle("width",c),$("playback_right").setStyle("height",d),$("gridTotalLength").setStyle("width",a-40),$("play2_sa").setStyle("width",a-40),$("play_axesOcx").setStyle("width",a-35),PlayBack.ajustScrollBar(a-70)}}function caculateFrameWH(){var a=document.documentElement.clientWidth,b=document.documentElement.clientHeight,c=89,d=a>1140?a:1140,e=b-c;return e=735>e?735:e,[d,e,a]}function caculatePlayFrameWH(){var a=document.documentElement.clientWidth,b=document.documentElement.clientHeight,c=56,d=a>1140?a:1140,e=b-c;return e=680>e?680:e,[d,e]}function onPageIndexReady(){if(jQuery("#index_logo").testBackgroundImage("/custom_logo/loginlogo.jpg"),jQuery("#sub_logo").testBackgroundImage("/custom_logo/logo.jpg"),$("login_install_dialog").translation(),g_forNacl)if(g_fromChromeApp)hasPlugin=!0;else{var a="https://chrome.google.com/webstore/detail/easy-viewer/anjoggeimnldigfcihcggejncophmhjc";$("login_install_dialog").getElement(".ui-dialog-content").set("html",tl("com_msg.needChromeApp")),$("login_btn_install").href=a}else!hasPlugin;if(webcapDefer.done(showPageWithWebcap),g_isRemoteLogin){var b=location.protocol+"//"+top.window.location.host+"/webplugin.exe";$("login_btn_install").href=b}$("l").translation(),$("m").translation(),setPlayAndAlarmPage(),initFrames(),getsetting(),showPreviewOCX(hasPlugin),g_pageID=0,$("login_btn_cancel").addEvent("click",function(){$("login_install_dialog").style.display="none"}),$("login_btn_install").addEvent("click",function(){$("login_install_dialog").style.display="none",checkPluginsCanUse(),"function"==typeof reloadPageAtloadedPluing&&reloadPageAtloadedPluing()}),g_isRemoteLogin?($("username").value=remoteParams.uName,$("password").value=remoteParams.pwd,hasPlugin?webcapDefer.done(login):($("l").style.display="",autoLoginWeb.delay(5e3))):skinLogin()}function skinLogin(){var a=!1,b=window.location.href,c=b.indexOf("?");if(c>=0){var d=b.slice(c+1),e=parseParams(Base64.decode(d));0>e?(e=parseParams(d),0>e||($("username").value=e.get("username"),$("password").value=e.get("password"),a=!0)):($("username").value=e.get("username"),$("password").value=e.get("password"),a=!0)}a&&($("l").style.display="none",hasPlugin&&login.delay(2e3))}function showPageWithWebcap(){g_vendor=webApp.webCap.vendor,g_bShowGB28181Client=webApp.webCap.showGb28181Client,g_busernameEncrypt=webApp.webCap.usernameEncrypt,g_showSecurityKey=webApp.webCap.supportSecurityKey,g_backIvs=webApp.webCap.supportBackIvs,g_bSupportFisheye=webApp.webCap.supportFishEye,g_strDeviceType=webApp.webCap.SystemDeviceType,g_mutiCastset=webApp.webCap.SupportNetMulticast,"foxconn"==webApp.webCap.demand&&($("username").maxLength=25,$("password").maxLength=25),"WatchNet"==g_vendor&&($("ul_login_or_reset").style.display="none",$("pswExpress_div").style.display="none",$("pswExpress_lab").style.display="none",$("oem_login_id").style.display="",$("oem_reset_id").style.display="",$("l").style.top="0%"),$("ul_ltype").style.display=isMac||g_useApp||$defined(webApp.webCap.loginType)&&webApp.webCap.loginType.length<=1?"none":"",g_mutiCastset||$("s_lgType").getChildren('option[value="3"]').dispose(),"QSee"===webApp.webCap.vendor&&($("net_lan").checked=!1,$("net_wan").checked=!0),$("ul_type").style.display=webApp.webCap.b_showLanRadio?"":"none","Kangle"==webApp.webCap.vendor&&g_ReservedUser.push.user,g_weakPasswordTip=webApp.webCap.b_weekPasswordTip,webApp.webCap.b_showPlainPassword&&($("pswExpress_div").style.display="",$("pswExpress_lab").style.display="")
}function setPlayAndAlarmPage(){$("frame_alarm").src="html/alarmindex.htm?"+(g_isRemoteLogin?"?"+remoteParams.ALL:""),loadJavaScript("/js/Calendar.js",function(){}),loadJavaScript("/js/PlayControl.js",function(){}),loadJavaScript("/js/FileList.js",function(){}),loadJavaScript("/js/WindowManager.js",function(){}),loadJavaScript("/js/Grid.js",function(){}),loadJavaScript("/js/GroupControl.js",function(){}),loadJavaScript("/js/playbackindex.js",function(){loadPlaybackHtml.delay(0)}),g_playAndAlarmLoad=!0}function autoLoginWeb(){checkPlugins()&&hasPlugin?login.delay(1e3):autoLoginWeb.delay(1e3)}function loadPlaybackHtml(){loadHtmlFile("../html/playbackindex.htm?"+remoteParams.ALL,function(a){$("f_playback").set("html",a).translation(),loadOcxAxes();var b=caculateFrameWH();$("play_page_playback").setStyle("width",b[0]),g_playLoadState=1},$empty)}function loadOcxAxes(){var a="";g_useApp?(a="<canvas id='timebar' width='1223' height='67'></canvas>",a+="<canvas id='timebar2' width='1228' height='67' ></canvas>",loadJavaScript("./timeaxes/TimeAxes.js",function(){}),loadJavaScript("./timeaxes/TimeAxesAdaptor.js",function(){}),loadJavaScript("./timeaxes/TimeGridLayer.js",function(){})):a=Sys.ie?"<object id='timeaxes' width='100%' height='100%' classid='CLSID:{classid}'></object>".substitute({classid:TIMEAXES_CLASSID}):'<object id="timeaxes" width="100%" height="100%" type="{axesType}"></object>'.substitute({axesType:TIMEAXES_MAINTYPE}),$("play_axesOcx")&&hasPlugin?$("play_axesOcx").innerHTML=a:loadOcxAxes.delay(1e3)}function initPageOcx(){g_bNewPlugin&&g_ocx.initialize(),g_frames.preview.ocx=g_ocx,getConfigPath.delay(5e3),setConfigPath.delay(6e3),bindOcxEvents()}function onPageLoaded(){g_previewLoaded=!0,g_isRemoteLogin||(showLoading(!1),g_isRemoteLogin||showLogin())}function showLoading(a){if(Sys.ie){var b=a?"block":"none";$("loading").style.display=b,$("lab_loading").style.display=b}}function setFrameHeight(a){$("frame_preview").setStyle("height",a+50)}function getCurAuthorityList(){var a=$("username").value,b=function(a){JSON.decode(a).result&&(g_authorityList=JSON.decode(a).params.user.AuthorityList)},c=UserManager.instance();c.getUserInfo(a,b,!1)}function checkAuthority(a){return null==g_authorityList?void 0:a?g_authorityList.contains(a)?!0:!1:!0}function getDiskPnts(){var a=new StorageDVR,b=!0,c=function(a){function c(){for(var a=function(a){if("array"!==$type(a.Partitions)||0===a.Partitions.length)return"Error";for(var b=0;b<a.Partitions.length;b++){if(!a.Partitions[b].MountOn)return"Error";if(a.Partitions[b].IsError)return"Error"}return"Running"},b=0;b<i.length;b++){var c=i[b].State;if("PhysicalVolume"==i[b].Volume&&"Running"==i[b].State&&(c=a(i[b])),"Error"===c)return void alert(tl("conf_alarm.diskerror"))}}b=JSON.decode(a).result;var d=[];if(b)if(JSON.decode(a).params&&(d=JSON.decode(a).params.list||[]),0==d.length){b=!1;var e=!1,f=ConfigManager.instance();f.getConfig("StorageGroup",function(a){if(JSON.decode(a).result)for(var b=getTable(a),c=0;c<b.length;c++)if($chk(b[c].Name)&&b[c].Name.contains("StoragePool")){e=!0;break}return e?void 0:void alert(tl("com_str.StorageNotExist"))})}else{var g=AsynChain.instance(),h=DevStorageManager.instance(),i=[],j=function(a,b){b.result&&b.params&&"array"===$type(b.params.device)&&i.combine(b.params.device.filter(function(a){var b=a.Raid&&a.Raid.State;return!("array"===$type(b)&&b.contains("CreatVG"))})),g._callChain()};Ability.iscsi.isSupportIscsi&&g.addChain(h.getDeviceInfos.bind(h),["iSCSI",j]),g.next(h.getDeviceInfos.bind(h),["InvidualPhysicalVolume",j]),Ability.isSupportRaid&&g.next(h.getDeviceInfos.bind(h),["RaidVolume",j]),g.done(c)}};a.getDirectoryPaths(c)}function getConfigPath(){return jQuery.Deferred(function(a){jQuery.when(g_ocx.GetConfigPath(1),g_ocx.GetConfigPath(2)).then(function(b,c){var d=Cookie.read("PrvWebSnapPath")||b,e=Cookie.read("PrvWebRecordPath")||c;d=tl(d),e=tl(e),Browser.Platform.win?g_useApp||(d=d||"C:\\PictureDownload",e=e||"C:\\RecordDownload"):(d=d||"/Applications/PictureDownload",e=e||"/Applications/RecordDownload"),Cookie.write("PrvWebSnapPath",d,{duration:30,path:"/"}),Cookie.write("PrvWebRecordPath",e,{duration:30,path:"/"}),a.resolve([d,e])})})}function setConfigPath(){jQuery.when(g_ocx.GetConfigPath(1),g_ocx.GetConfigPath(2)).done(function(a,b){var c=Cookie.read("PrvWebSnapPath")||a,d=Cookie.read("PrvWebRecordPath")||b;c=tl(c),d=tl(d),Browser.Platform.win?g_useApp||(c=c||"C:\\PictureDownload",d=d||"C:\\RecordDownload"):(c=c||"/Applications/PictureDownload",d=d||"/Applications/RecordDownload"),g_ocx&&g_ocx.SetConfigPath(1,c),g_ocx&&g_ocx.SetConfigPath(2,d)})}function loadPlayAndAlarmPage(){$("frame_alarm").src="html/alarmindex.htm?"+remoteParams.ALL,loadJavaScript("/js/Calendar.js",function(){}),loadJavaScript("/js/PlayControl.js",function(){}),loadJavaScript("/js/FileList.js",function(){}),loadJavaScript("/js/WindowManager.js",function(){}),loadJavaScript("/js/Grid.js",function(){}),loadJavaScript("/js/GroupControl.js",function(){}),loadJavaScript("/Component/chnlGroup.js",function(){}),loadJavaScript("/js/playbackindex.js",function(){loadPlaybackHtml.delay(0)}),g_playAndAlarmLoad=!0}function onScrollForNacl(a){if(g_useApp){var b=$("f_ocx"),c=parseInt(b.getStyle("top")),d=parseInt(b.getStyle("left"));changeOcxStyle({top:c,left:d},a)}}function webViewAlert(a){var b={method:"webViewAlert",params:{okTip:tl("com_button.comok"),msg:a}};g_NaclWin.postMessage(b,"*")}function getPassword(){return $("password").value}function setVideoSecurityKey(a){g_VideoSecurity=a,g_ocx.ProtocolPluginWithWebCall(JSON.encode({Protocol:"SetSecurityKey",Params:{key:a,enable:!0}}))}var g_deviceType="DVR",g_deviceSubType="",g_vendor="",g_busernameEncrypt=!1,g_currBrowserVersion=0,g_minBrowserVersion=39,g_forNacl=!1,g_fromChromeApp=!1,g_bSupportPos=!1,g_bSupportFisheye=!0,g_ReservedUser=["default"],g_abroadInfo="Mainland",g_hasNewVersion=!1,g_isShowIVS=!0,g_wifiDevice=!1,Capability={tagEnable:function(){return webApp.webCap.b_supportTagManage},videoLockEnable:function(){return webApp.webCap.b_supportVideoLock}},g_strDeviceType="",Sys={},isMac=-1!=navigator.userAgent.toLowerCase().indexOf("mac"),ua=navigator.userAgent.toLowerCase(),s;(s=ua.match(/(msie\s|trident.*rv:)([\d.]+)/))?Sys.ie=s[2]:(s=ua.match(/firefox\/([\d.]+)/))?Sys.firefox=s[1]:(s=ua.match(/chrome\/([\d.]+)/))?Sys.chrome=s[1]:(s=ua.match(/opera.([\d.]+)/))?Sys.opera=s[1]:(s=ua.match(/version\/([\d.]+).*safari/))?Sys.safari=s[1]:0;var g_haveqt=!1;if(navigator.plugins)for(var i=0;i<navigator.plugins.length;i++)navigator.plugins[i].name.indexOf("QuickTime")>=0&&(g_haveqt=!0);if(void 0!=Sys.chrome&&null!=Sys.chrome&&Sys.chrome.length>0){var nIndex=Sys.chrome.indexOf(".");g_currBrowserVersion=nIndex>0?Sys.chrome.substring(0,nIndex).toInt():Sys.chrome.toInt(),g_currBrowserVersion>g_minBrowserVersion&&(checkMimeType(["video/mp4","application/x-vnd.google.update3webcontrol.3","application/x-vnd.google.oneclickctrl.9"])||(g_forNacl=!0),g_useApp&&(g_fromChromeApp=!0,g_forNacl=!0))}var jsonLang,g_pageID=0,g_loginInfo={username:"",password:"",loginType:0,hasLogin:!1},g_basePassword="",g_authorityList,g_alarmed=0,g_previewLoaded=!1,g_isSDIDev=0,g_stateUpgrading=!1,g_stateIPCUpdate=!1,g_firstIPCUpdate=!0,HashCookie=new Hash.Cookie("PrvWebCookie",{duration:30}),settings={username:"",pswd:"",talktype:"1",logintype:"0",openall:"1",loginid:""},g_frames={preview:"",playback:"",setup:"",alarm:"",info:""},g_bNewPlugin="D9CA2B5E-C180-4EB1-9E60-345C2956174D"==PLUGINS_CLASSID,g_mode="Preview",g_netType=0,g_playLoadState=0,g_timerdcs=null,remoteParams={},g_playAndAlarmLoad=!1,g_userNameLimit=[1,6],g_passWordLimit=[0,6],g_groupNameLimit=[1,6],g_weakPasswordTip=!0,g_bShowGB28181Client=!1,g_showSecurityKey=!1,g_VideoSecurity="",g_backIvs=!0,g_privateStr=Base64.decode("RGFodWE="),g_privateStrEx=Base64.decode("ZGFodWE=");getRemoteParams();var dlgModAdminPassword=null,dlgNerverShowModAdminPassword=null,dlgEmptyPasswordWarn=null,g_modadminpwdLevel=null,keepAliveDef=null;Sys.firefox||Sys.safari?window.addEvent("beforeunload",function(a){return g_ocx.ControlTalking(0),g_stateUpgrading?(alert(tl("com_msg.UpgradingForbidExitWeb")),void a.preventDefault()):(g_stateIPCUpdate&&(cancelUpgrade(),g_stateIPCUpdate=!1,a.preventDefault()),void doLogout())}):(window.addEvent("beforeunload",function(){var a=Sys.ie&&(event.clientY<0||event.altKey);return g_stateUpgrading&&a?(alert(tl("com_msg.UpgradingForbidExitWeb")),void(event.returnValue="")):void(g_stateIPCUpdate&&a&&(cancelUpgrade(),g_stateIPCUpdate=!1,event.returnValue=""))}),window.addEvent("unload",function(){(Sys.ie||g_useApp)&&hasPlugin&&g_ocx&&("Preview"==g_mode&&(g_ocx.ControlTalking(0),g_ocx.PlayStopSound(),g_ocx.DisConnectAllChannel()),PlayBack.goLogout(),g_ocx.LogoutDevice()),g_useApp&&changeOcxMode("Hidden"),doLogout()})),window.addEvent("resize",function(){resize()}),window.onload=function(){$("login_showpwd").checked=!1,seajs.use("/Component/findPwd",function(a){webApp.webCap.b_SupportDeviceInit&&$("forgettPwd").setStyle("display",""),"none"==$("ul_ltype").getStyle("display")&&$("login_forgetPwd_div").setStyle("margin-top","-70px"),jQuery("#forgettPwd").on("click",function(){a.startInit()})})};